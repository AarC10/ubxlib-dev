# Instance Matrix
The table below defines the instances of test hardware available on the `ubxlib` test farm and how each one is currently configured.  It is parsed and used by the functions in `u_data.py` to know what to do so please always ensure that it is a properly formatted Markdown format table.

The first digit of the instance ID represents either a physical thing: a board connected via a COM port/debugger, or a distinct process (e.g. run Lint).  The remaining digits represent variants, e.g. using different SDKs on a board.

The MCU field must match a unique MCU name from one of the `platform/<platform>/mcu/<mcu>` directories (e.g `esp32`), the platform name one of the `platform/<platform>` directories (e.g `esp-idf`), where a choice of compilation toolchains is available the toolchain name must match a sub-directory of `platform/<platform>/mcu/<mcu>`, each API must be the name of one in the directory structure (e.g. `port` for the porting API), module names must be used consistently as must the second/third digit(s) of the instance ID (e.g. for NRF52840 variant 0 is always the nRF5 SDK, variant 1 is always the Zephyr SDK, etc.); case is ignored.  If a module name begins with `SARA` it will be prefixed by the test automation code with `U_CELL_MODULE_TYPE_` and then assigned to a compilation flag `U_CFG_TEST_CELL_MODULE_TYPE` for use during testing.  Likewise, if a module name begins with `NINA`, `ANNA` or `ODIN` it will be prefixed by the test automation code with `U_SHORT_RANGE_MODULE_TYPE_` and then assigned to a compilation flag `U_CFG_TEST_SHORT_RANGE_MODULE_TYPE` for use during testing

Note: the Zephyr platform requires board-level definitions rather than just MCU-family definitions, hence the MCU field for the Zephyr platform is treated somewhat differently to all others.

|  ID   | Description                                |     MCU     | Platform  | Toolchain  | Module(s) (separate with spaces) |  APIs available (separate with spaces)      | #define overrides (separate with spaces) |
| :---: | ------------------------------------------ | :---------: | :-------: | :--------: | :------------------------------: | ------------------------------------------- | ---------------------------------------- |
| 0.0   | Run Lint                                   |             |           |            |                                  |                                             |                                          |
| 0.1   | Run Lint with logging off                  |             |           |            |                                  |                                             | U_CFG_ENABLE_LOGGING=0                   |
| 0.2   | Run Lint with stubs files                  |             |           |            |                                  |                                             | U_CFG_LINT_USE_STUBS                     |
| 0.3   | Run Lint with internal Ble                 |             |           |            |                                  |                                             | U_CFG_BLE_MODULE_INTERNAL                |
| 1     | Run Doxygen                                |             |           |            |                                  |                                             |                                          |
| 2     | Run AStyle style checker (for advice only) |             |           |            |                                  |                                             |                                          |
| 3     | Run Pylint                                 |             |           |            |                                  |                                             |                                          |
| 4     | Run static size check                      |             |           |            |                                  |                                             |                                          |
| 5     | Run no floating point check                |             |           |            |                                  |                                             |                                          |
| 6     | Reserved                                   |             |           |            |                                  |                                             |                                          |
| 7     | Reserved                                   |             |           |            |                                  |                                             |                                          |
| 8     | Reserved                                   |             |           |            |                                  |                                             |                                          |
| 9     | Reserved                                   |             |           |            |                                  |                                             |                                          |
| 10    | WHRE board (NINA-W1), Cat M1               |    ESP32    |  ESP-IDF  |            | SARA_R412M_03B                   | port network sock cell mqtt_client          | U_CFG_TEST_PIN_A=-1 U_CFG_TEST_PIN_B=-1 U_CFG_TEST_PIN_C=-1 U_CFG_TEST_UART_A=-1 |
| 11    | ESP32-DevKitC + EVK                        |    ESP32    |  ESP-IDF  |            |                                  | port at_client                              | U_CFG_TEST_UART_B=1 U_CFG_TEST_PIN_UART_A_CTS=-1 U_CFG_TEST_PIN_UART_A_RTS=-1 U_CFG_TEST_PIN_UART_A_RXD=26 U_CFG_TEST_PIN_UART_B_TXD=27 U_CFG_TEST_PIN_UART_B_RXD=14 |
| 12    | ESP32-DevKitC + EVK, Cat M1                |    ESP32    |  ESP-IDF  |            | SARA_R5 NINA_W15                 | port network sock ble cell short_range security mqtt_client | U_CFG_APP_PIN_CELL_TXD=21 U_CFG_APP_PIN_CELL_RXD=19 U_CFG_APP_PIN_CELL_VINT=-1 U_CFG_APP_PIN_CELL_ENABLE_POWER=-1 U_BLE_TEST_CFG_REMOTE_SPS_CENTRAL=2462ABB6CC42p U_CFG_TEST_SECURITY_C2C_TE_SECRET=\x00\x01\x02\x03\x04\x05\x06\x07\xff\xfe\xfd\xfc\xfb\xfa\xf9\xf8 |
| 13.0.0| Nordic DK board (NRF52840) + EVK, Cat M1   | NRF52840DK  |  nRF5SDK  |     GCC    | SARA_R5                          | port at_client cell sock network mqtt_client | U_CFG_TEST_UART_B=0 U_CFG_TEST_PIN_UART_A_CTS=-1 U_CFG_TEST_PIN_UART_A_RTS=-1 U_CFG_TEST_PIN_UART_B_TXD=44 U_CFG_TEST_PIN_UART_B_RXD=43 U_CFG_TEST_PIN_UART_A_RXD=45 |
| 13.0.1| Nordic DK board (NRF52840) + EVK           | NRF52840DK  |  nRF5SDK  |     SES    |                                  | port at_client                              | U_CFG_TEST_UART_B=0 U_CFG_TEST_PIN_UART_A_CTS=-1 U_CFG_TEST_PIN_UART_A_RTS=-1 U_CFG_TEST_PIN_UART_B_TXD=44 U_CFG_TEST_PIN_UART_B_RXD=43 U_CFG_TEST_PIN_UART_A_RXD=45 |
| 13.1  | Nordic DK board (NRF52840) + EVK           | NRF52840DK  |  Zephyr   |            |                                  | port at_client                              | U_CFG_TEST_UART_B=0                      |
| x14   | STM32F4 Discovery (STM32F407) + EVK, Cat M1|   STM32F4   | STM32Cube |            | SARA_R412M_02B                   | port network sock security cell             | HSE_VALUE=((uint32_t)8000000U) U_CFG_TEST_UART_A=-1 U_CFG_APP_PIN_C030_ENABLE_3V3=-1 U_CFG_APP_PIN_CELL_RESET=-1 U_CFG_APP_CELL_UART=3 U_CFG_APP_PIN_CELL_TXD=0x38 U_CFG_APP_PIN_CELL_RXD=0x39 U_CFG_APP_PIN_CELL_RTS=-1 U_CFG_APP_PIN_CELL_CTS=-1 U_CFG_TEST_SECURITY_C2C_TE_SECRET=\x00\x01\x02\x03\x04\x05\x06\x07\xff\xfe\xfd\xfc\xfb\xfa\xf9\xf8 |
| 15.0.0| Nordic DK board (NRF52840) + EVK           | NRF52840DK  |  nRF5SDK  |     GCC    |                                  | port                                        |                                          |
| 15.0.1| Nordic DK board (NRF52840) + EVK, Cat M1   | NRF52840DK  |  nRF5SDK  |     SES    |                                  | port network ble short_range                | U_BLE_TEST_CFG_REMOTE_SPS_CENTRAL=2462ABB6CC42p |
| 15.1  | Nordic DK board (NRF52840) + EVK           | NRF52840DK  |  Zephyr   |            |                                  | port network ble short_range                | U_CFG_TEST_UART_A=-1 U_CFG_BLE_MODULE_INTERNAL U_BLE_TEST_CFG_REMOTE_SPS_CENTRAL=2462ABB6CC42p U_BLE_TEST_CFG_REMOTE_SPS_PERIPHERAL=2462ABB6EAC6p U_CFG_APP_SHORT_RANGE_ROLE=1 |
| x16   | C030-U201 board (STM32F437), 3G            |   STM32F4   | STM32Cube |            | SARA_U201                        | port network sock cell at_client            | U_CFG_APP_CELL_UART=2 U_CFG_APP_PIN_CELL_TXD=0x35 U_CFG_APP_PIN_CELL_RXD=0x36 U_CFG_APP_PIN_CELL_RTS=0x34 U_CFG_APP_PIN_CELL_CTS=0x33 U_CFG_TEST_UART_B=1 U_CFG_TEST_PIN_UART_B_TXD=0x16 U_CFG_TEST_PIN_UART_B_RXD=0x17 U_CFG_TEST_PIN_UART_A_RTS=-1 U_CFG_TEST_PIN_UART_A_CTS=-1 |
| 17    | Nordic NRF5340 PDK board                   | NRF5340PDK  |  Zephyr   |            |                                  | port network ble short_range lib_common     | U_CFG_BLE_MODULE_INTERNAL U_BLE_TEST_CFG_REMOTE_SPS_CENTRAL=2462ABB6CC42p U_BLE_TEST_CFG_REMOTE_SPS_PERIPHERAL=2462ABB6EAC6p U_CFG_APP_SHORT_RANGE_ROLE=1 |
| 18    | Nordic NRF5340 PDK board + EVK, Cat M1     | NRF5340PDK  |  Zephyr   |            | SARA_R5                          | port network sock security cell lib_common mqtt_client | U_CFG_TEST_PIN_A=-1 U_CFG_TEST_PIN_B=-1 U_CFG_TEST_PIN_C=-1 U_CFG_TEST_UART_A=-1 U_CFG_TEST_SECURITY_C2C_TE_SECRET=\x00\x01\x02\x03\x04\x05\x06\x07\xff\xfe\xfd\xfc\xfb\xfa\xf9\xf8 |
| 19    | C030-R5 board (STM32F437), Cat M1          |   STM32F4   | STM32Cube |            | SARA_R5 NINA_W15                 | port network sock ble cell short_range security mqtt_client | U_CFG_TEST_PIN_A=-1 U_CFG_TEST_PIN_B=-1 U_CFG_TEST_PIN_C=-1 U_CFG_TEST_UART_A=-1 U_BLE_TEST_CFG_REMOTE_SPS_CENTRAL=2462ABB6CC42p U_CFG_TEST_SECURITY_C2C_TE_SECRET=\x00\x01\x02\x03\x04\x05\x06\x07\xff\xfe\xfd\xfc\xfb\xfa\xf9\xf8 |

Notes:
- Don't change existing instance IDs without checking the rest of the automation system for scripts which "know" about their numbers (e.g. the `esp32` ones do).
- The "APIs available" column indicates which APIs are available to *test* on a given instance; any APIs available on an instance will usually be tested but the `u_select.py` automation script (see [README.md](README.md#script-usage)) can use the APIs in this column when chosing a reduced set of APIs to test.
- The #defines listed are *overrides* on the default values that are defined in the code or additional to those defined in the code; they are not a complete list.
- The instances on which `at_client` is available to test use the same wiring as the other boards but allocate UARTs to pins differently: two UARTs are used for back-to-back testing, no flow control, and the CTS/RTS pins that are back-to-back connected for `port` UART testing are instead allocated to the second UART; on these instances the `port` UART test will be skipped.
- The cellular tests take quite a long time to run and so where there are two SDKs on a single platform usually only one of them will run the cellular tests to keep the execution time down.

# Maintenance
- When adding a new API make sure that it is present in at least one of the entries above, otherwise it may NOT be detected and tested at all on a branch that is not `master` (where a smaller, focused set of tests are carried out).
